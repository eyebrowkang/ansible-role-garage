---
- name: Deploy Garage configuration
  ansible.builtin.template:
    src: garage.toml.j2
    dest: "{{ garage_config_dir }}/garage.toml"
    owner: "{{ garage_daemon_user }}"
    group: "{{ garage_daemon_group }}"
    mode: '0640'
  notify: Restart garage

- name: Deploy Garage systemd unit
  ansible.builtin.template:
    src: garage.service.j2
    dest: /etc/systemd/system/garage.service
    mode: '0644'
  notify: Restart garage

- name: Enable and start Garage service
  ansible.builtin.systemd_service:
    name: garage
    state: started
    enabled: true
    daemon_reload: true
